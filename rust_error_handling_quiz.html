<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust 错误处理快问快答</title>
    <link rel="stylesheet" href="quiz-styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🦀 Rust 错误处理快问快答</h1>
            <p>测试你对 Rust 错误处理机制的理解：Result、Option、panic! 等</p>
        </div>

        <div class="quiz-info">
            <div class="info-item">
                <div class="number">10</div>
                <div class="label">题目数量</div>
            </div>
            <div class="info-item">
                <div class="number">20</div>
                <div class="label">预计时间(分钟)</div>
            </div>
            <div class="info-item">
                <div class="number">⭐⭐⭐</div>
                <div class="label">难度等级</div>
            </div>
        </div>

        <div class="content">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- 题目1 -->
            <div class="question" data-question="1">
                <div class="question-number">第1题 (判断题)</div>
                <div class="question-text">
                    在Rust中，Result<T, E>类型用于表示可能失败的操作，其中T表示成功时的值类型，E表示错误类型。
                </div>
                <div class="options">
                    <div class="option" data-answer="true">正确</div>
                    <div class="option" data-answer="false">错误</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：正确</strong></p>
                    <p>Result<T, E>是Rust中处理可恢复错误的标准类型。</p>
                    <p>T是成功情况下Ok(T)中包含的值类型，E是失败情况下Err(E)中包含的错误类型。</p>
                    <p>这种设计强制开发者显式处理错误情况。</p>
                </div>
            </div>

            <!-- 题目2 -->
            <div class="question" data-question="2">
                <div class="question-number">第2题 (选择题)</div>
                <div class="question-text">
                    下列哪个操作符用于传播错误，即如果Result是Err则提前返回错误？
                </div>
                <div class="options">
                    <div class="option" data-answer="false">!</div>
                    <div class="option" data-answer="true">?</div>
                    <div class="option" data-answer="false">&</div>
                    <div class="option" data-answer="false">*</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：?</strong></p>
                    <p>?操作符是Rust中的错误传播操作符，用于简化错误处理。</p>
                    <p>如果Result是Ok(value)，则返回value；如果是Err(error)，则提前返回Err(error)。</p>
                    <p>这大大减少了手动match Result的样板代码。</p>
                </div>
            </div>

            <!-- 题目3 -->
            <div class="question" data-question="3">
                <div class="question-number">第3题 (选择题)</div>
                <div class="question-text">
                    Option<T>类型的两个变体是什么？
                </div>
                <div class="options">
                    <div class="option" data-answer="false">Ok(T) 和 Err(E)</div>
                    <div class="option" data-answer="true">Some(T) 和 None</div>
                    <div class="option" data-answer="false">Success(T) 和 Failure</div>
                    <div class="option" data-answer="false">Value(T) 和 Empty</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：Some(T) 和 None</strong></p>
                    <p>Option<T>用于表示可能存在或不存在的值。</p>
                    <p>Some(T)表示存在值T，None表示没有值。</p>
                    <p>这避免了空指针异常，是Rust安全性的重要组成部分。</p>
                </div>
            </div>

            <!-- 题目4 -->
            <div class="question" data-question="4">
                <div class="question-number">第4题 (判断题)</div>
                <div class="question-text">
                    panic!宏会导致程序立即终止，无法被捕获和处理。
                </div>
                <div class="options">
                    <div class="option" data-answer="false">正确</div>
                    <div class="option" data-answer="true">错误</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：错误</strong></p>
                    <p>panic!可以通过std::panic::catch_unwind函数捕获。</p>
                    <p>不过panic!主要用于不可恢复的错误，通常表示程序逻辑错误。</p>
                    <p>在大多数情况下，应该使用Result来处理可恢复的错误。</p>
                </div>
            </div>

            <!-- 题目5 -->
            <div class="question" data-question="5">
                <div class="question-number">第5题 (选择题)</div>
                <div class="question-text">
                    下面哪个方法用于获取Result中的值，如果是Err则panic？
                </div>
                <div class="options">
                    <div class="option" data-answer="false">get()</div>
                    <div class="option" data-answer="true">unwrap()</div>
                    <div class="option" data-answer="false">extract()</div>
                    <div class="option" data-answer="false">value()</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：unwrap()</strong></p>
                    <p>unwrap()方法会返回Ok中的值，如果是Err则调用panic!。</p>
                    <p>类似的还有expect(msg)，可以提供自定义的panic消息。</p>
                    <p>在生产代码中应谨慎使用，更推荐使用模式匹配或?操作符。</p>
                </div>
            </div>

            <!-- 题目6 -->
            <div class="question" data-question="6">
                <div class="question-number">第6题 (简答题)</div>
                <div class="question-text">
                    请写出两个用于处理Option<T>的常用方法，一个用于提供默认值，一个用于链式调用。
                </div>
                <input type="text" class="text-input" placeholder="请输入答案，用逗号分隔" data-answer="unwrap_or,map">
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：unwrap_or, map（或其他合理答案）</strong></p>
                    <p>unwrap_or(default)：如果是Some(T)返回T，如果是None返回默认值。</p>
                    <p>map(f)：如果是Some(T)则应用函数f得到Some(f(T))，如果是None保持None。</p>
                    <p>其他常用方法还有：unwrap_or_else, and_then, or_else等。</p>
                </div>
            </div>

            <!-- 题目7 -->
            <div class="question" data-question="7">
                <div class="question-number">第7题 (选择题)</div>
                <div class="question-text">
                    在函数签名中，下面哪个表示函数可能返回错误？
                </div>
                <div class="options">
                    <div class="option" data-answer="false">fn foo() -> i32</div>
                    <div class="option" data-answer="true">fn foo() -> Result<i32, String></div>
                    <div class="option" data-answer="false">fn foo() -> Option<i32></div>
                    <div class="option" data-answer="false">fn foo() -> i32!</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：fn foo() -> Result<i32, String></strong></p>
                    <p>Result<T, E>明确表示函数可能成功返回T或失败返回错误E。</p>
                    <p>Option<T>表示可能有值或没有值，但不是错误处理。</p>
                    <p>这种显式的错误处理是Rust安全性的重要特征。</p>
                </div>
            </div>

            <!-- 题目8 -->
            <div class="question" data-question="8">
                <div class="question-number">第8题 (判断题)</div>
                <div class="question-text">
                    在Rust中，所有的错误都必须被显式处理，编译器不允许忽略Result类型的返回值。
                </div>
                <div class="options">
                    <div class="option" data-answer="false">正确</div>
                    <div class="option" data-answer="true">错误</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：错误</strong></p>
                    <p>虽然Rust鼓励显式错误处理，但可以使用let _ = 来忽略Result。</p>
                    <p>编译器会对未使用的Result发出警告，但不是编译错误。</p>
                    <p>可以使用#[must_use]属性强制要求处理某些类型的返回值。</p>
                </div>
            </div>

            <!-- 题目9 -->
            <div class="question" data-question="9">
                <div class="question-number">第9题 (选择题)</div>
                <div class="question-text">
                    下面哪个是创建自定义错误类型的最佳实践？
                </div>
                <div class="options">
                    <div class="option" data-answer="false">使用String作为错误类型</div>
                    <div class="option" data-answer="true">实现std::error::Error trait</div>
                    <div class="option" data-answer="false">使用i32错误码</div>
                    <div class="option" data-answer="false">使用panic!处理所有错误</div>
                </div>
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：实现std::error::Error trait</strong></p>
                    <p>实现Error trait提供了标准的错误处理接口。</p>
                    <p>这样的错误类型可以与其他Rust错误处理工具很好地集成。</p>
                    <p>通常还会实现Display和Debug trait来提供错误信息。</p>
                </div>
            </div>

            <!-- 题目10 -->
            <div class="question" data-question="10">
                <div class="question-number">第10题 (简答题)</div>
                <div class="question-text">
                    在Rust中，什么情况下应该使用panic!而不是Result？请简述一种情况。
                </div>
                <input type="text" class="text-input" placeholder="请输入答案" data-answer="程序逻辑错误">
                <div class="explanation">
                    <h4>答案解析：</h4>
                    <p><strong>答案：程序逻辑错误（或类似表述）</strong></p>
                    <p>panic!适用于不可恢复的错误，特别是程序逻辑错误。</p>
                    <p>例如：数组越界、除零、断言失败等情况。</p>
                    <p>这些错误通常表示程序存在bug，应该修复代码而不是处理错误。</p>
                    <p>而Result适用于可预期的、可恢复的错误，如文件不存在、网络连接失败等。</p>
                </div>
            </div>

            <div class="text-center">
                <button class="btn" id="submitBtn" onclick="submitQuiz()">提交答案</button>
                <button class="btn" id="showAnswersBtn" onclick="showAllAnswers()" style="display: none;">查看所有解析</button>
                <button class="btn" id="restartBtn" onclick="restartQuiz()" style="display: none;">重新开始</button>
            </div>

            <div class="final-results" id="finalResults">
                <div class="result-icon" id="resultIcon">🎉</div>
                <div class="result-text" id="resultText">恭喜完成测验！</div>
                <div class="result-score" id="finalScore">10/10</div>
                <div id="resultMessage">你对Rust错误处理的掌握非常出色！</div>
            </div>
        </div>
    </div>

    <script>
        let userAnswers = {};
        let totalQuestions = 10;
        let quizSubmitted = false;

        // 处理选择题选项点击
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                if (quizSubmitted) return;
                
                const question = this.closest('.question');
                const questionNum = question.dataset.question;
                
                // 清除同一题目的其他选项
                question.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // 选中当前选项
                this.classList.add('selected');
                
                // 记录答案
                userAnswers[questionNum] = {
                    type: 'option',
                    answer: this.dataset.answer === 'true',
                    element: this
                };
                
                updateProgress();
            });
        });

        // 处理简答题输入
        document.querySelectorAll('.text-input').forEach(input => {
            input.addEventListener('input', function() {
                if (quizSubmitted) return;
                
                const question = this.closest('.question');
                const questionNum = question.dataset.question;
                
                userAnswers[questionNum] = {
                    type: 'text',
                    answer: this.value.trim(),
                    element: this
                };
                
                updateProgress();
            });
        });

        function submitQuiz() {
            if (Object.keys(userAnswers).length < totalQuestions) {
                alert('请完成所有题目后再提交！');
                return;
            }
            
            quizSubmitted = true;
            let correctCount = 0;
            
            // 检查答案并显示结果
            for (let questionNum in userAnswers) {
                const userAnswer = userAnswers[questionNum];
                const question = document.querySelector(`[data-question="${questionNum}"]`);
                const explanation = question.querySelector('.explanation');
                
                if (userAnswer.type === 'option') {
                    // 处理选择题
                    const isCorrect = userAnswer.answer;
                    if (isCorrect) {
                        correctCount++;
                        userAnswer.element.classList.add('correct');
                    } else {
                        userAnswer.element.classList.add('incorrect');
                        // 显示正确答案
                        question.querySelectorAll('.option').forEach(opt => {
                            if (opt.dataset.answer === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }
                } else if (userAnswer.type === 'text') {
                    // 处理简答题（关键词匹配）
                    const userText = userAnswer.answer.toLowerCase();
                    
                    let isCorrect = false;
                    if (questionNum === '6') {
                        // 第6题：检查Option处理方法
                        isCorrect = (userText.includes('unwrap_or') || userText.includes('unwrap_or_else')) && 
                                   (userText.includes('map') || userText.includes('and_then') || userText.includes('or_else'));
                    } else if (questionNum === '10') {
                        // 第10题：检查panic使用场景
                        isCorrect = userText.includes('逻辑错误') || userText.includes('程序错误') || 
                                   userText.includes('bug') || userText.includes('不可恢复') ||
                                   userText.includes('断言') || userText.includes('越界') ||
                                   userText.includes('除零') || userText.includes('程序逻辑');
                    }
                    
                    if (isCorrect) {
                        correctCount++;
                        userAnswer.element.style.borderColor = '#27ae60';
                        userAnswer.element.style.backgroundColor = '#d5f4e6';
                    } else {
                        userAnswer.element.style.borderColor = '#e74c3c';
                        userAnswer.element.style.backgroundColor = '#fdf2f2';
                    }
                }
                
                explanation.style.display = 'block';
            }
            
            // 显示最终结果
            showFinalResults(correctCount);
            
            // 更新按钮状态
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('showAnswersBtn').style.display = 'inline-block';
            document.getElementById('restartBtn').style.display = 'inline-block';
        }

        function showAllAnswers() {
            document.querySelectorAll('.explanation').forEach(explanation => {
                explanation.style.display = 'block';
            });
            
            document.getElementById('showAnswersBtn').style.display = 'none';
        }

        function restartQuiz() {
            // 重置所有变量
            userAnswers = {};
            quizSubmitted = false;
            
            // 清除所有选择和样式
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            document.querySelectorAll('.text-input').forEach(input => {
                input.value = '';
                input.style.borderColor = '';
                input.style.backgroundColor = '';
            });
            
            // 隐藏所有解释
            document.querySelectorAll('.explanation').forEach(explanation => {
                explanation.style.display = 'none';
            });
            
            // 重置结果显示
            document.getElementById('finalResults').style.display = 'none';
            
            // 重置按钮状态
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('showAnswersBtn').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'none';
            
            // 更新显示
            updateProgress();
            
            // 滚动到顶部
            window.scrollTo(0, 0);
        }

        function updateProgress() {
            const answeredCount = Object.keys(userAnswers).length;
            const progress = (answeredCount / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showFinalResults(correctCount) {
            const percentage = (correctCount / totalQuestions) * 100;
            const finalResults = document.getElementById('finalResults');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const finalScore = document.getElementById('finalScore');
            const resultMessage = document.getElementById('resultMessage');
            
            finalScore.textContent = `${correctCount}/${totalQuestions} (${percentage.toFixed(1)}%)`;
            
            if (percentage >= 90) {
                resultIcon.textContent = '🏆';
                resultText.textContent = '优秀！';
                resultMessage.textContent = '你对Rust错误处理的掌握非常出色！';
            } else if (percentage >= 70) {
                resultIcon.textContent = '🎉';
                resultText.textContent = '良好！';
                resultMessage.textContent = '你对Rust错误处理有很好的理解！';
            } else if (percentage >= 50) {
                resultIcon.textContent = '📚';
                resultText.textContent = '继续努力！';
                resultMessage.textContent = '建议复习Rust错误处理的相关概念。';
            } else {
                resultIcon.textContent = '💪';
                resultText.textContent = '需要加强！';
                resultMessage.textContent = '建议深入学习Rust错误处理机制。';
            }
            
            finalResults.style.display = 'block';
            finalResults.scrollIntoView({ behavior: 'smooth' });
        }

        // 初始化进度条
        updateProgress();
    </script>
</body>
</html>